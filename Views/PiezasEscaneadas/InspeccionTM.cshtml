@using ProducScan.ViewModels

@{
    ViewData["Title"] = "Inspección por TM";
    ViewData["Subtitle"] = "Piezas Inspeccionadas por Team Member.";
}

@model List<InspeccionTMViewModel>

<style>
    .bg-overprod {
        background-color: #ff7354 !important; /* rojo claro tipo subtle */
        color: #fff !important; /* texto blanco */
    }

    .border-overprod {
        border: 3px solid #ff1f58 !important; /* contorno rojo fuerte */
    }
</style>

<form method="get" class="mb-4">
    <div class="row g-3">
        <div class="col-12 col-md-4">
            <label for="fecha" class="fw-bold">Seleccionar fecha:</label>
            <input type="date" id="fecha" name="fecha" class="form-control rounded-pill"
                   value="@ViewBag.FechaSeleccionada"
                   max="@TimeZoneInfo.ConvertTimeFromUtc(DateTime.UtcNow, TimeZoneInfo.FindSystemTimeZoneById("Central Standard Time (Mexico)")).ToString("yyyy-MM-dd")" />
        </div>
        <div class="col-12 col-md-4">
            <label for="turno" class="fw-bold">Seleccionar turno:</label>
            <select id="turno" name="turno" class="form-select rounded-pill">
                <option value="1" selected="@(ViewBag.TurnoSeleccionado == "1")">Turno 1</option>
                <option value="2" selected="@(ViewBag.TurnoSeleccionado == "2")">Turno 2</option>
                <option value="3" selected="@(ViewBag.TurnoSeleccionado == "3")">Turno 3</option>
            </select>
        </div>
        <div class="col-12 col-md-4 d-flex align-items-end">
            <button type="submit" class="btn btn-primary w-100 rounded-pill">
                <i class="bi bi-search"></i> Buscar
            </button>
        </div>
    </div>
</form>
<div class="row mb-3">
    <div class="col-12">
        <div class="card shadow-sm border-0 rounded-3">
            <div class="card-body">
                <h6 class="fw-bold mb-2">📊Significado</h6>
                <div class="row text-center">
                    <div class="col-6 col-md-3 mb-2">
                        <span class="badge bg-danger-subtle text-white">&nbsp;&nbsp;&nbsp;</span>
                        <div>Fuera de meta</div>
                    </div>
                    <div class="col-6 col-md-3 mb-2">
                        <span class="badge bg-success-subtle text-success">&nbsp;&nbsp;&nbsp;</span>
                        <div>En meta</div>
                    </div>
                    <div class="col-6 col-md-3 mb-2">
                        <span class="badge bg-warning-subtle text-dark">&nbsp;&nbsp;&nbsp;</span>
                        <div>Cerca de la meta</div>
                    </div>
                    <div class="col-6 col-md-3 mb-2">
                        <span class="badge bg-overprod border-overprod">&nbsp;&nbsp;&nbsp;</span>
                        <div>Sobreproducción</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row mb-4">
    <!-- Skeletons -->
    <div id="skeletons" class="row">
        @for (int i = 0; i < 6; i++)
        {
            <div class="col-12 col-sm-12 col-md-12 col-lg-6 col-xl-4 col-xl-4 col-xxl-3 mb-3">
                <div class="card shadow-sm border-0 rounded-4 h-100">
                    <div class="card-body d-flex align-items-center">
                        <div class="me-3 flex-shrink-0">
                            <span class="placeholder rounded-circle" style="width:70px;height:70px;"></span>
                        </div>
                        <div class="flex-grow-1">
                            <div class="placeholder-glow mb-2">
                                <span class="placeholder col-8"></span>
                            </div>
                            <div class="placeholder-wave mb-2">
                                <span class="placeholder col-6"></span>
                            </div>
                            <div class="placeholder-glow">
                                <span class="placeholder col-4"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>

    <!-- Cards reales -->
    <div id="cards" class="row d-none">
        @foreach (var tm in Model)
        {
            <div class="col-12 col-sm-12 col-md-12 col-lg-6 col-xl-4 col-xl-4 col-xxl-3 mb-3">
                <a asp-action="DetallePorUsuario"
                   asp-route-fecha="@($"{ViewBag.Año}-{ViewBag.Mes:00}-{ViewBag.Dia:00}")"
                   asp-route-usuario="@tm.TM"
                   asp-route-turno="@ViewBag.TurnoSeleccionado"
                   class="card card-hover shadow-sm rounded-4 @tm.ColorCard h-100 text-decoration-none"
                   data-bs-toggle="tooltip"
                   title="@tm.TM">

                    <div class="card-body m-1 d-flex flex-column flex-sm-row align-items-center">
                        <div class="me-sm-3 mb-2 mb-sm-0 flex-shrink-0 text-center">
                            <img src="@tm.FotoUrl"
                                 alt="Foto de @tm.TM"
                                 class="rounded-circle"
                                 style="width:70px;height:70px;object-fit:cover;border:2px solid #fff;" />
                        </div>
                        <div class="flex-grow-1 text-start overflow-hidden">
                            <div class="fw-bold text-primary-emphasis text-truncate fs-6">
                                <i class="bi bi-person-badge me-1"></i>@tm.TM
                            </div>
                            <div class="text-muted small">
                                <i class="bi bi-grid-3x3-gap me-1"></i>@tm.Mesa
                            </div>
                            <div class="fw-bold text-info fs-6 mb-1">
                                <i class="bi bi-box-seam me-1"></i>Total Piezas
                            </div>
                            <div class="fw-bold text-primary-emphasis fs-4">
                                @tm.TotalPiezas
                            </div>
                        </div>
                    </div>
                </a>
            </div>
        }
    </div>


</div>


@section Scripts{

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Mostrar skeletons al inicio
            var skeletons = document.getElementById("skeletons");
            var cards = document.getElementById("cards");

            // Después de 2 segundos, ocultar skeletons y mostrar cards
            setTimeout(function () {
                if (skeletons) skeletons.classList.add("d-none");
                if (cards) cards.classList.remove("d-none");

                // Inicializar tooltips de Bootstrap
                var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
                tooltipTriggerList.map(function (tooltipTriggerEl) {
                    return new bootstrap.Tooltip(tooltipTriggerEl);
                });
            }, 500);
        });
    </script>

}


    @using ProducScan.ViewModels

    @{
        ViewData["Title"] = "Inspección por TM";
        ViewData["Subtitle"] = "Piezas Inspeccionadas por Team Member.";
        
    }

    @model List<InspeccionTMViewModel>

<style>
    .legend-badge {
        display: inline-block;
        width: 30px;
        height: 20px;
        border-radius: 4px;
        margin-right: 8px;
    }
</style>

<div class="w-full mb-6">
   

    <!-- Formulario de filtros -->
    <form method="get" class="mb-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
            <div>
                <label for="fecha" class="font-bold text-sm">Seleccionar fecha:</label>
                <input type="date" id="fecha" name="fecha"
                       class="w-full border rounded-full px-3 py-2"
                       value="@ViewBag.FechaSeleccionada"
                       max="@TimeZoneInfo.ConvertTimeFromUtc(DateTime.UtcNow, TimeZoneInfo.FindSystemTimeZoneById("Central Standard Time (Mexico)")).ToString("yyyy-MM-dd")" />
            </div>
            <div>
                <label for="turno" class="font-bold text-sm">Seleccionar turno:</label>
                <select id="turno" name="turno"
                        class="w-full border rounded-full px-3 py-2">
                    <option value="1" selected="@(ViewBag.TurnoSeleccionado == "1")">Turno 1</option>
                    <option value="2" selected="@(ViewBag.TurnoSeleccionado == "2")">Turno 2</option>
                    <option value="3" selected="@(ViewBag.TurnoSeleccionado == "3")">Turno 3</option>
                </select>
            </div>
            <div>
                <button type="submit"
                        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-full px-3 py-2">
                    🔍 Buscar
                </button>
            </div>
        </div>
    </form>
    <!-- Leyenda y botón de regreso -->
    <div class="w-full bg-white shadow-md rounded-lg p-3 mb-4 text-sm">
        <h5 class="font-semibold text-center mb-3">📊 Significado de colores</h5>
        <div class="flex flex-wrap justify-center gap-4 text-xs mb-3">
            <div class="flex items-center gap-1">
                <span class="w-5 h-3 rounded bg-red-300 border border-red-500"></span> Fuera de meta
            </div>
            <div class="flex items-center gap-1">
                <span class="w-5 h-3 rounded bg-yellow-400 border border-yellow-500"></span> Cerca de la meta
            </div>
            <div class="flex items-center gap-1">
                <span class="w-5 h-3 rounded bg-green-500 border border-green-600"></span> En meta
            </div>
            <div class="flex items-center gap-1">
                <span class="w-5 h-3 rounded bg-pink-600 border border-pink-700"></span> Sobreproducción
            </div>
        </div>

        <!-- Botón único para ir a InspeccionTMTV -->
        <div class="text-center">
            <a href="@Url.Action("InspeccionTMTV", "PiezasEscaneadas")"
               class="inline-block bg-blue-600 hover:bg-blue-700 text-white text-xs font-semibold px-3 py-1 rounded">
                ⬅️ Ir a Inspección TM TV vista
            </a>
        </div>
    </div>
    <!-- Skeletons y Cards -->
    <div class="mb-6">
        <!-- Skeletons -->
        <div id="skeletons" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
            @for (int i = 0; i < 6; i++)
            {
                <div class="bg-white shadow-md rounded-lg p-4 flex items-center space-x-4">
                    <span class="rounded-full bg-gray-300 animate-pulse" style="width:70px;height:70px;"></span>
                    <div class="flex-1 space-y-2">
                        <div class="h-4 bg-gray-300 rounded animate-pulse w-3/4"></div>
                        <div class="h-4 bg-gray-300 rounded animate-pulse w-1/2"></div>
                        <div class="h-4 bg-gray-300 rounded animate-pulse w-1/3"></div>
                    </div>
                </div>
            }
        </div>

        <!-- Cards reales -->
        <div id="cards" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 hidden">
            @foreach (var tm in Model)
            {


                string colorClass;
                string estado;

                if (tm.TotalPiezas >= tm.Meta + 400)
                {
                    colorClass = "bg-red-600 text-white";
                    estado = "Sobreproducción";
                }
                else if (tm.TotalPiezas >= tm.Meta)
                {
                    colorClass = "bg-green-500 text-white";
                    estado = "En meta";
                }
                else if (tm.TotalPiezas >= tm.Meta - 400 && tm.TotalPiezas < tm.Meta - 100)
                {
                    colorClass = "bg-yellow-400 text-black";
                    estado = "Cerca de la meta";
                }
                else if (tm.TotalPiezas < tm.Meta - 400)
                {
                    colorClass = "bg-red-300 text-black";
                    estado = "Fuera de meta";
                }
                else
                {
                    colorClass = "bg-green-500 text-white";
                    estado = "En meta";
                }

                <div class="bg-white shadow-md rounded-lg flex flex-col overflow-hidden">
                    <!-- Contenido principal -->
                    <div class="p-4 flex items-center space-x-4 flex-grow">
                        <img src="@tm.FotoUrl"
                             alt="Foto de @tm.TM"
                             class="rounded-full border-2 border-grey-800"
                             style="width:70px;height:70px;object-fit:cover;" />
                        <div class="flex-1 overflow-hidden">
                            <div class="font-bold truncate text-sm text-gray-800">👤 @tm.TM</div>
                            <div class="text-xs text-gray-500">🪑 @tm.Mesa</div>
                            <div class="font-semibold text-blue-600 text-sm mt-1">📦 Total Piezas</div>
                            <div class="font-bold text-lg text-gray-700">@tm.TotalPiezas</div>
                            @* <div class="text-xs text-gray-500">🔧 Mandrel: @tm.UltimoMandrel</div> *@
                        </div>
                    </div>

                    <!-- Franja inferior dinámica -->
                    <div class="@colorClass w-full py-1 text-center text-xs font-semibold">
                        @estado
                    </div>
                </div>
            }
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var skeletons = document.getElementById("skeletons");
            var cards = document.getElementById("cards");

            // Después de 0.5 segundos, ocultar skeletons y mostrar cards
            setTimeout(function () {
                if (skeletons) skeletons.classList.add("hidden");   // Tailwind
                if (cards) cards.classList.remove("hidden");        // Tailwind
            }, 500);
        });
    </script>
}

